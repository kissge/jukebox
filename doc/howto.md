想定作成手順
==========

作業を始める前に
-------------

1. PHPとComposerをインストールする
   * PHPについて予備知識がない場合は自習せよ。
   * PHPは少なくとも5.3以上でなければならない。5.6以上であることが望ましい。可能な限り7.0以上をインストールすることに挑戦せよ。
   * [Composer](https://getcomposer.org/)はPHPのパッケージマネージャである。導入は[Symfony Cookbook](http://symfony.com/doc/current/cookbook/composer.html)などを参考にせよ。
2. gitをインストールする
   * gitについて予備知識がない場合は自習せよ。
   * このプロジェクトに関してはすべてのコミットをmasterブランチに作って構わない。
3. 開発を始める
   * `app/config/parameters.yml` を適切にセットアップする
     * ただし `composer install` 時に無い場合は対話的に作ることも出来るのでそれでもよい。
   * `composer install` して依存ライブラリを導入する。
   * `app/console doctrine:schema:create`, `app/console doctrine:schema:update` などによってデータベースに必要なテーブルを作る。
     * エンティティを編集するたびに `update` の作業は必要になる可能性がある。
   * `app/console fos:user:create` してテストユーザを作成する。
     * ログイン画面からログイン出来ることを確認する。

Symfonyについて
--------------

SymfonyはPHPで書かれたWebフレームワークである。
Docコメントによるアノテーションを多様する特徴がある。
このプロジェクトではバージョン2.8を前提とするが、それ以降のバージョンであれば同様に動く可能性がある。
Symfony自体に関する知識は公式のQuick Tour（[表紙](http://symfony.com/doc/2.8/quick_tour/the_big_picture.html), [1](http://symfony.com/doc/2.8/quick_tour/the_view.html), [2](http://symfony.com/doc/2.8/quick_tour/the_controller.html), [3](http://symfony.com/doc/2.8/quick_tour/the_architecture.html)）を参考にせよ。
類似のWebフレームワークによる開発経験がない場合は、MVCなどのデザインプラクティスについて調べることを推奨する（ただしSymfonyが公式にMVCフレームワークを自称しているわけではない）。

このソースコードについて
--------------------

このプロジェクトでは、実際の開発で用いているライブラリを同様に使って欲しいなどの理由から幾つかの作業を事前に済ませてある。
具体的には：

* Symfonyアプリケーションの新規作成 (`symfony new jukebox 2.8`)
* FOSUserBundleのインストールとログイン機能の実装
* Userエンティティの作成

方針
----

このプロジェクトでは、以下のことを守ることが望ましい。

* ソースコードは人が読める程度に綺麗に書く。
  * 特にコメント、コミットメッセージは日本語で書き、タイプミスが無いと望ましい。
  * Symfonyのコーディング規約を守る。
* PHP 5.3未満との後方互換性は気にしなくて良い。特にPHP 7.0以上で開発する場合には7.0未満との後方互換性も気にしなくて良い。
* コミットは適切な粒度で切る。
  * git-rebase(1)などをうまく使って過去のコミットを修正したほうが良い場合がある。
  * 迷った場合はなるべく細く切れば良い。
* 「最終的に作りたいものを考えれば与えられた具体的な指示は不適切で、本当はそれよりよい方法がある」と思われる場合には、より良い方法を取る。
* （見た目の）デザインはひとまず気にしないで良い。

作成手順
-------

以下大まかな手順のみを述べる。
具体的な操作やコーディングについては自助努力せよ。

ヒント：箇条書きの1項目をgitの一つのコミットに対応付けるとよい。

以下は必須課題である。

1. Videoエンティティの作成
   * SymfonyにおいてエンティティはMVCで言うモデルに相当する概念である。
     * すでにUserエンティティが存在するので参考になるかもしれない。
   * 必要なメンバ変数は動画のURLと登録者と最終再生日時。型は考えよ。
   * 登録者を記録するということは、一つのMovieには一人のUserが結びつく。[Doctrineのマニュアル](http://doctrine-orm.readthedocs.io/projects/doctrine-orm/en/latest/reference/association-mapping.html)を参考にせよ。
   * ヒント：`app/console doctrine:generate:entity` コマンドを使うといくらか手間が軽減される可能性がある
2. 動画キュー表示画面の作成
   * コントローラのAction
   * パスは `/video`
   * 存在するすべてのVideoエンティティを取得して一覧表示すれば良い。
     * 最終再生日時が古いものが先に並ぶようにする。
   * ビューを表示するのに [`@Template`](http://symfony.com/doc/current/bundles/SensioFrameworkExtraBundle/annotations/view.html) アノテーションを使うと記述量が少なくなる。
   * なお `/video` 以下のパスにはログイン時しかアクセス出来ないように制約を書いてある。
3. 動画追加フォームの作成
   * パスは `/video/new` (POST)
   * 動画キュー表示画面にフォームを追加すればよい。
   * 追加成功後は動画キュー表示画面にリダイレクトさせる。
4. 動画削除フォームの作成
   * パスは `/video/{id}` (DELETE)
   * 削除成功後は動画キュー表示画面にリダイレクトさせる。
   * actionをJavaScriptで動的に変更する、フォームの要素としてidを渡す、など実装はいくつか方針が考えられる。良いと思うものを実装せよ。
5. 動画再生画面の作成
   * パスは `/play`
   * ここでは実際に動画が再生されない「ダミー」画面で良い。
   * 動画キュー表示画面で表示される順序に動画を並べたときに先頭に来る動画に関する情報を表示する。
     * このとき該当の動画の最終再生日時を更新する。
   * 画面遷移図ではログイン画面へのリンクを貼ることになっているが、動画キュー表示画面へのリンクを貼れば良い。
     * 動画キュー表示画面はログインしていないと表示できないように設定されているため、ログインされていないユーザはログイン画面にリダイレクトされることになる。

以下は行うことが望ましい課題である。順不同。

1. 動画のURLに適切なバリデーションを設定せよ。
2. 動画キュー表示画面から動画を編集できるようにせよ。
3. 動画の追加・削除・編集成功時にFlashメッセージを表示せよ。
4. ユーザを管理する権限を持つ管理者ユーザを作成できるようにし、管理画面を作成せよ。
5. 同時に2人以上の人が動画再生画面を開けないように排他制御する。

以下は泣くほど暇だったらやってください。順不同。

1. ウェブデザインに自信がある場合はいい感じにデザインまで作りこむ。
2. 実際に動画プレーヤを埋め込むことで動画の再生機能を実装し、システム全体が動くようにする。
   * イメージとしては、共用のパソコンがジュークボックス代わりに設置されており、社内のユーザは自分のスマートフォンから好きな動画を登録することが出来、共用のパソコンでそれらの動画が流れ続ける、というシステムを構築することを考える。
3. WebSocketなどを用いて、誰かが動画を登録したときにリアルタイムに動画再生画面に通知が表示されるようにする。
4. YouTubeから簡単に動画を登録できるbookmarkletまたはブラウザ拡張を作成する。
